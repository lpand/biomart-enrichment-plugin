/**
 * copyright: Olivier Combe (https://github.com/ocombe/angular-localForage)
 */
(function(e,t,n){"use strict";var r=t.module("LocalForageModule",["ng"]);r.provider("$localForage",function(){e.localForageConfig={name:"lf"};this.notify={setItem:false,removeItem:false};this.setPrefix=function(n){if(t.isDefined(n)&&n!==e.localForageConfig.name){e.localForageConfig.name=n;localforage._initStorage(e.localForageConfig)}};var n=function(e){return localforage.setDriver(e)};this.setDriver=n;var r=function(){return localforage.driver()};this.setNotify=function(e,t){this.notify={setItem:e,removeItem:t}};this.config=function(r){if(t.isObject(r)){e.localForageConfig=r;if(t.isDefined(r.driver)){return n(r.driver)}else{return localforage._initStorage(r)}}};this.$get=["$rootScope","$q","$parse",function(e,i,s){var o=this.notify;var u={};var a=function(){return r()==="localStorageWrapper"?"lfp.":""};var f=function(e,t,i,s){if(e==="InvalidStateError"&&r()==="asyncStorage"){n("localStorageWrapper").then(function(){i(t).then(function(e){s.resolve(e)},function(e){s.reject(e)})},function(){s.reject(e)})}else{s.reject(e)}};var l=function(t,n){var r=i.defer(),s=arguments;localforage.setItem(a()+t,n).then(function(){if(o.setItem){e.$broadcast("LocalForageModule.setItem",{key:t,newvalue:n,driver:localforage.driver()})}r.resolve()},function(t){f(t,s,l,r)});return r.promise};var c=function(e){var t=i.defer(),n=arguments;localforage.getItem(a()+e).then(function(n){t.resolve(n)},function(r){f(r,n,c,t)});return t.promise};var h=function(t){var n=localforage.removeItem(a()+t);if(o.setItem){return n.then(function(n){e.$broadcast("LocalForageModule.removeItem",{key:t,driver:localforage.driver()})})}else{return n}};var p=function(){var e=i.defer(),n=arguments,r=[];m().then(function(s){t.forEach(s,function(e){r.push(h(e))});i.all(r).then(function(){e.resolve()})},function(r){f(r,n,clearAll,e)});return e.promise};var d=function(e){var t=i.defer(),n=arguments;localforage.key(e).then(function(n){t.resolve(n)},function(r){f(r,n,d,t)});return t.promise};var v=function(){var e=i.defer(),t=arguments;localforage.length().then(function(n){e.resolve(n)},function(r){f(r,t,v,e)});return e.promise};var m=function(){var e=i.defer(),t=arguments;v().then(function(n){var r=[],s=[],o=a();for(var u=0;u<n;u++){r.push(d(u).then(function(e){if(e.indexOf(o)===0){s.push(e.substr(o.length,e.length))}}))}i.all(r).then(function(){e.resolve(s)})},function(r){f(r,t,m,e)});return e.promise};var g=function(e,n){if(t.isString(n)){n={key:n}}else if(!t.isObject(n)||t.isUndefined(n.key)){throw"You must defined a key to bind"}var r={defaultValue:"",storeName:""};n=t.extend(r,n||{});var i=n.storeName||n.key,o=s(n.key);return c(i).then(function(r){if(r){o.assign(e,r)}else if(n.defaultValue){l(i,n.defaultValue)}if(t.isDefined(u[n.key])){u[n.key]()}u[n.key]=e.$watch(s(n.key),function(e){if(t.isDefined(e)){l(i,e)}},true)})};var y=function(e,n,r){r=r||n;s(n).assign(e,null);if(t.isDefined(u[n])){u[n]();delete u[n]}h(r)};return{setDriver:n,driver:r,getDriver:r,setItem:l,set:l,getItem:c,get:c,remove:h,removeItem:h,clear:p,clearAll:p,key:d,getKeyAt:d,getKeys:m,length:v,getLength:v,bind:g,unbind:y}}]});r.directive("localForage",["$localForage",function(e){return{restrict:"A",link:function(n,r,i){var s=n.$eval(i.localForage);if(t.isObject(s)&&t.isDefined(s.key)&&t.isDefined(s.storeName)){e.bind(n,s)}else{e.bind(n,i.localForage)}}}}])})(window,window.angular)